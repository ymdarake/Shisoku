# 問題データベース 静的JSON - ファイルサイズシミュレーション

## 問題データの構造

```typescript
interface Problem {
  numbers: number[];           // [1, 2, 3, 4]
  target: number;              // 6
  category: 'no-parens' | 'one-paren' | 'multi-paren';
  simplestSolution?: string;   // "(1 + 2) + 3" (オプション)
}
```

## 1問あたりのデータサイズ

### ケース1: 解答例なし（最小構成）

```json
{
  "numbers": [1, 2, 3, 4],
  "target": 6,
  "category": "one-paren"
}
```

**サイズ**: 約70-80バイト/問（圧縮前、整形なし）

### ケース2: 解答例あり（フル構成）

```json
{
  "numbers": [1, 2, 3, 4],
  "target": 6,
  "category": "one-paren",
  "simplestSolution": "(1 + 2) * 3 - 4"
}
```

**サイズ**: 約110-130バイト/問（圧縮前、整形なし）

---

## ファイルサイズシミュレーション

### 前提条件

- **1問の平均サイズ**:
  - 解答例なし: 75バイト
  - 解答例あり: 120バイト
- **gzip圧縮率**: 約65%圧縮（35%に削減）
- **配列のオーバーヘッド**: 全体で約50バイト（`[]`と外側のJSON構造）

### シナリオ1: 解答例なし（最小構成）

| 問題数 | 非圧縮サイズ | gzip圧縮後 | 備考 |
|--------|-------------|-----------|------|
| 100問 | 7.5 KB | **2.6 KB** | 超軽量 |
| 500問 | 37.5 KB | **13 KB** | 軽量 |
| 1,000問 | 75 KB | **26 KB** | 許容範囲 |
| 2,000問 | 150 KB | **53 KB** | やや大きい |
| 5,000問 | 375 KB | **131 KB** | 大きい |
| 10,000問 | 750 KB | **263 KB** | かなり大きい |

### シナリオ2: 解答例あり（フル構成）

| 問題数 | 非圧縮サイズ | gzip圧縮後 | 備考 |
|--------|-------------|-----------|------|
| 100問 | 12 KB | **4.2 KB** | 超軽量 |
| 500問 | 60 KB | **21 KB** | 軽量 |
| 1,000問 | 120 KB | **42 KB** | 許容範囲 |
| 2,000問 | 240 KB | **84 KB** | やや大きい |
| 5,000問 | 600 KB | **210 KB** | 大きい |
| 10,000問 | 1.2 MB | **420 KB** | かなり大きい |

---

## 現在のゲームビルドサイズとの比較

### 現在のビルドサイズ（gzip圧縮後）
```
- HTML: 0.32 KB
- CSS: 4.57 KB
- JS: 154.15 KB
---------------------
合計: 159 KB
```

### 問題データベース追加後のサイズ

#### 解答例なし（推奨）

| 問題数 | 総サイズ | 増加率 | 評価 |
|--------|---------|-------|------|
| 100問 | 159 + 2.6 = **161.6 KB** | +1.6% | ✅ 問題なし |
| 500問 | 159 + 13 = **172 KB** | +8.2% | ✅ 許容範囲 |
| 1,000問 | 159 + 26 = **185 KB** | +16.3% | ✅ 許容範囲 |
| 2,000問 | 159 + 53 = **212 KB** | +33.3% | ⚠️ やや大きい |
| 5,000問 | 159 + 131 = **290 KB** | +82.4% | ❌ 大きすぎ |
| 10,000問 | 159 + 263 = **422 KB** | +165.4% | ❌ 大きすぎ |

#### 解答例あり

| 問題数 | 総サイズ | 増加率 | 評価 |
|--------|---------|-------|------|
| 100問 | 159 + 4.2 = **163.2 KB** | +2.6% | ✅ 問題なし |
| 500問 | 159 + 21 = **180 KB** | +13.2% | ✅ 許容範囲 |
| 1,000問 | 159 + 42 = **201 KB** | +26.4% | ✅ 許容範囲 |
| 2,000問 | 159 + 84 = **243 KB** | +52.8% | ⚠️ やや大きい |
| 5,000問 | 159 + 210 = **369 KB** | +132.1% | ❌ 大きすぎ |
| 10,000問 | 159 + 420 = **579 KB** | +264.2% | ❌ 大きすぎ |

---

## 実際のJSONサイズ検証

### サンプルデータ（10問）

```json
[
  {"numbers":[8,5,2,1],"target":3,"category":"no-parens"},
  {"numbers":[9,4,3,2],"target":8,"category":"one-paren"},
  {"numbers":[7,6,5,1],"target":2,"category":"multi-paren"},
  {"numbers":[8,3,2,1],"target":7,"category":"no-parens"},
  {"numbers":[9,7,4,2],"target":5,"category":"one-paren"},
  {"numbers":[6,5,4,3],"target":9,"category":"multi-paren"},
  {"numbers":[8,6,3,1],"target":4,"category":"no-parens"},
  {"numbers":[9,5,3,2],"target":6,"category":"one-paren"},
  {"numbers":[7,4,2,1],"target":1,"category":"no-parens"},
  {"numbers":[8,7,5,3],"target":0,"category":"multi-paren"}
]
```

**実測サイズ**: 566バイト（整形なし）
**1問あたり**: 56.6バイト（配列オーバーヘッド含む）

→ より圧縮効率が良い（予想より小さい）

### 再計算（実測ベース）

| 問題数 | 非圧縮 | gzip (35%) | 評価 |
|--------|-------|-----------|------|
| 100問 | 5.7 KB | **2.0 KB** | ✅ 超軽量 |
| 500問 | 28 KB | **9.8 KB** | ✅ 軽量 |
| 1,000問 | 57 KB | **20 KB** | ✅ 許容範囲 |
| 2,000問 | 113 KB | **40 KB** | ✅ 許容範囲 |
| 5,000問 | 283 KB | **99 KB** | ⚠️ やや大きい |
| 10,000問 | 566 KB | **198 KB** | ⚠️ 大きい |

---

## 推奨事項

### ✅ 推奨: 1,000-2,000問（静的JSON）

**理由:**
- **ファイルサイズ**: 20-40 KB（gzip圧縮後）
  - 現在のビルドサイズ（159 KB）の12-25%増加
  - 総サイズ: 179-199 KB（初期ロード200 KB以下を維持）
- **問題の多様性**: 十分なバリエーション
  - 1ユーザーが100回プレイ（1000問消費）しても重複少ない
  - カテゴリ別に分類すれば効率的
- **実装の簡潔性**: Firebaseなしで完結

### 問題数の内訳（2,000問の場合）

| カテゴリ | 問題数 | 割合 |
|----------|--------|------|
| no-parens | 800問 | 40% |
| one-paren | 800問 | 40% |
| multi-paren | 400問 | 20% |

### 難易度別の使用比率（1ゲーム10問）

**Easy:**
- no-parens: 10問（100%）

**Normal:**
- no-parens: 5問（50%）
- one-paren: 5問（50%）

**Hard:**
- no-parens: 2問（20%）
- one-paren: 4問（40%）
- multi-paren: 4問（40%）

---

## Firestoreと静的JSONの比較

### 静的JSON（推奨: 1,000-2,000問）

**メリット:**
- ✅ 完全オフライン動作
- ✅ セットアップ不要
- ✅ デプロイ簡単
- ✅ 追加コストゼロ
- ✅ ファイルサイズ許容範囲（+20-40 KB）

**デメリット:**
- ❌ 問題更新にはデプロイ必要
- ❌ 問題数は2,000問程度が限界
- ❌ 後から問題を追加しにくい

### Firestore（大規模運用向け）

**メリット:**
- ✅ 問題数無制限
- ✅ リアルタイム更新可能
- ✅ 統計データ取得可能（どの問題が難しいか等）
- ✅ 質の悪い問題を後から削除可能

**デメリット:**
- ❌ Firebaseセットアップ必要
- ❌ オンライン必須（初回ロード時）
- ❌ APIキー管理が必要
- ❌ 実装複雑

---

## 最終推奨

### 段階的アプローチ

**Phase 1: 静的JSON（1,000-2,000問）**
- 初期リリースはこれで十分
- ファイルサイズ増加: +20-40 KB（許容範囲）
- 実装シンプル、すぐリリース可能

**Phase 2: Firestore移行（必要に応じて）**
- ユーザーが増えて問題の質向上が求められたら移行
- 静的JSONをFirestoreにインポート
- 段階的に新問題追加

---

## ファイル配置案（静的JSON）

```
src/
├── data/
│   └── problems.json          # 1,000-2,000問
├── service/
│   ├── problemDatabase.ts     # 問題取得ロジック
│   └── gameLogic.ts           # 式評価のみ
└── ...
```

### problemDatabase.tsのインターフェース

```typescript
export const getProblems = (
  difficulty: Difficulty,
  count: number = 10
): Problem[] => {
  // カテゴリ比率に基づいてランダム選択
  // 重複を避ける
  return selectedProblems;
};
```

---

**結論**: 静的JSON（1,000-2,000問）で開始し、必要に応じてFirestoreに移行するのが最適な戦略です。

*シミュレーション作成日: 2025-01-16*
